<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/sky.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>

  <body>
    <div class="reveal">
      <div class="slides">
	<section>
	  <h3>Living with Kubernetes</h3>

	  <h6>Tristan Straub</h6>
	</section>

	<section>
	  <h3>Introduction</h3>
	  <ul>
	    <li>kubernetes</li>
	    <li>just enough to be dangerous</li>
	    <li>move fast, break things (saying from friend)</li>
	  </ul>
	</section>

	<section>
	  <h3>driven to find ubiquitous distributed computing platform</h3>
	  <ul>
	    <li>any hardware platform</li>
	    <li>jvm?</li>
	    <li>browser?</li>
	    <li>docker</li>
	  </ul>
	</section>	

	<section>
	  <h3>consul, nomad agent + nomad server</h3>
	  <ul>
<li>simple</li>
<li>declarative description of services (hcl -- hashicorp configuration language)</li>
<li>hashicorps other tools: terraform, packer</li>
	  </ul>
	</section>	

	<section>
	  <h3>trip through the cloud</h3>
	  <ul>
	    <li>vpc/ansible, pets, no docker</li>
	    <li>elastic beanstalk, cattle, docker</li>
	    <li>slow deploys</li>
	    <li>machine per service</li>
	  </ul>
	</section>	

	<section>
	  <h3>Docker</h3>
	  <ul>
	    <li>isolation: process group, network stack, file system</li>
	    <li>layered file system</li>
	    <li>provides executable documentation with the same intent as ansible, puppet, chef.</li>
	    <li>osx: host port bindings on osx dont work, but kubernetes!</li>
	  </ul>
	</section>	

	<section>
	  <h3>cicd/always tested/promoted builds</h3>
	  <ul>
	    <li>rails, wiki in 20 minutes, heroku push to deploy</li>
	    <li>tdd</li>
	    <li>deploy early, deploy often</li>
	    <li>master is always deployable</li>
	  </ul>
	</section>

	<section>
	  <h3>recent project</h3>
	  <ul>
	    <li>azure, no availability zones in sydney, and only two fault domains in sydney</li>
	    <li>ci/cd</li>
	    <li>stateless compute and web services</li>
	    <li>on premise -> cloud</li>
	  </ul>
	</section>	

	<section>
	  <h3>compute options</h3>
	  <ul>
<li>docker swarm (felt too slapped on)</li>
<li>nomad (not enough community support)</li>
<li>kubernetes (supported by large company, moving fast)</li>
	  </ul>
	</section>	

	<section>
	  <h3>infra options</h3>
	  <ul>
	    <li>terraform vs ARM</li>
	    <li>packer</li>
	  </ul>
	</section>	

	<section>
	  <h3>getting familiar with kubernetes</h3>
	  <h4>local dev, minikube(xhyve)</h4>
<li>minikube</li>
<li>docker/osx native kubernetes</li>
<li>kubectl expose creates services on local ports.</li>
	</section>	

	<section>
	  <h3>kops (aws)</h3>
	  <ul>
	    <li>quick to start,</li>
	    <li>played with spot instances </li>
	    <li>returning 6 months later, couldn't get it to work as a private cluster.</li>
	  </ul>
	</section>	

	<section>
	  <h3>acs-engine</h3>
	  <ul>
	    <li>template engine for azure resource templates (5 minutes to come up)</li>
	    <li>terraformed external resources</li>
	    <li>version changes from 1.8.3 with classic networking then to azure CNI 1.8.4+ (own misunderstanding?)</li>
	    <li>small changes to config are time wasters (often unstable to begin with).</li>

	  </ul>
	</section>	

	<section>
	  <h3>public master or bastion/vpn</h3>
	  <ul>
	    <li>decouple VPN from kubernetes network</li>
	    <li>machines not named uniquely</li>
	    <li>configuration finds the machines</li>
	  </ul>
	</section>	

	<section>
	  <h3>subnet design, separation of production/staging.</h3>
	  <ul>
	    <li>embedding cluster with other resources</li>
	    <li>ipv4, does kafka/cassandra work with ipv4?</li>
	    <li>subdivision, VPN, kafka, cassandra, k8s master + agent nodes.</li>
	    <li>pods are in own private network.</li>
	  </ul>
	</section>	

	<section>
	  <h3>native load balancers</h3>
	  <ul>
	    <li>very convenient</li>
	    <li>internal/external</li>
	  </ul>
	</section>	

	<section>
	  <h3>public vs private master</h3>
	  <ul>
	    <li>kops and acs-engine created public master nodes, (with security groups)</li>
	    <li>acs-engine private cluster only became stable very recently,</li>
	    <li>could not get kops working as private cluster</li>
	  </ul>
	</section>	

	<section>
	  <h3>HA clusters</h3>
	  <ul>
	    <li>multi master</li>
	    <li>HA for apiserver</li>
	  </ul>
	</section>	
	
	<section>
	  <h3>kubectl proxy and the API</h3>
	  <ul>
<li>provided authorized access to kubernetes</li>
<li>used as proxy for data-config from circleci and when locally deploying.</li>
	  </ul>
	</section>
	
	<section>
	  <h3>service abstraction</h3>
	  <ul>
	    <li>expose pods externally.</li>
	  </ul>
	</section>

	<section>
	  <h3>circleci</h3>
	  <ul>
	    <li>per branch deploys</li>
	    <li>remote build + deploy</li>
	    <li>remote build + local deploy (staging -> prod)</li>
	    <li>data-config: Namespace, ConfigMap, Deployment, Service (not secrets)</li>
	  </ul>
	</section>
	
	<section>
	  <h3>docker registry (private)</h3>
	  <ul>
<li>aws has per container repositories</li>
<li>azure has multi container repositories</li>
	  </ul>
	</section>
	
	<section>
	  <h3>naming deploys (unique)</h3>
	  <ul>
	    <li>config and deployments uniquely named per deploy.</li>
	    <li>services deployed once, not uniquely named.</li>
	    <li>secrets not uniquely named.</li>
	  </ul>
	</section>

	<section>
	  <h3>secrets</h3>
	  <ul>
	    <li>tmpfs</li>
	    <li>file based, or bring as environment variables.</li>
	    <li>per namespace</li>
	  </ul>
	</section>	
	
	<section>
	  <h3>memory limits, jvm (kswapd), outage</h3>
	  <ul>
	    <li>make requests/limits the same</li>
	    <li>bin packing</li>
	    <li>deployments distribute evenly</li>
	    <li>cicd requires space for new pods/containers</li>
	  </ul>
	</section>	
	
	<section>
	  <h3>config, how config naming and automatic reloading can hurt</h3>
	  <ul>
	    <li>naming configs (unique)</li>
	  </ul>
	</section>	
	
	<section>
	  <h3>namespaces aren't enough (staging consuming production resources)</h3>
	  <ul>
	    <li>but are great</li>
	    <li>separate services</li>
	    <li>consumer same IP space</li>
	  </ul>
	</section>	
	
	<section>
	  <h3>dashboard</h3>
	  <ul>
	    <li>great tool</li>
	    <li>kubectl proxy -> localhost:8081/ui</li>
	  </ul>
	</section>	
	
	<section>
	  <h3>agent node is a shared resource (memory, cpu, network) (shared living)</h3>
	  <ul>
	    
	  </ul>
	</section>	
	
	<section>
	  <h3>Recommendations</h3>
	  <ul>
<li>kubernetes is a moving target (deprecated options, new networking options)</li>
<li>needs one full time effective just on kubernetes.</li>
<li>Or, use a managed service</li>
	  </ul>
	</section>	
	
	<section>
	  <h3>Further reading: service mesh, network policies, rbac, operators for stateful services</h3>
	  <ul>
	    <li></li>
	  </ul>
	</section>
	
	<section>
	  <h3>spinnaker, jenkins, jenkinsx, rancher</h3>
	  <ul>
	    <li></li>
	  </ul>
	</section>	
	
	<section>
	  <h3></h3>
	  <ul>
	    <li></li>
	  </ul>
	</section>	
	
	<section>
	  <h3></h3>
	  <ul>
	    <li></li>
	  </ul>
	</section>	
	
	<section>
	  <h3></h3>
	  <ul>
	    <li></li>
	  </ul>
	</section>	
	
	
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
      dependencies: [
      { src: 'plugin/markdown/marked.js' },
      { src: 'plugin/markdown/markdown.js' },
      { src: 'plugin/notes/notes.js', async: true },
      { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
      ]
      });
    </script>
  </body>
</html>
